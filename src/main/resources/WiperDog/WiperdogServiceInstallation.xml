<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>WiperDog</web>
  <name>WiperdogServiceInstallation</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>WiperDog.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1381906004000</creationDate>
  <date>1385709374000</date>
  <contentUpdateDate>1385709374000</contentUpdateDate>
  <version>1.1</version>
  <title>WiperdogServiceInstallation</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <object>
    <class>
      <name>XWiki.JavaScriptExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>0</number>
    <className>XWiki.JavaScriptExtension</className>
    <guid>c5f2e53b-dbc8-460e-8bff-5fab443cfc1c</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
<code>require(['jquery'], function($) {
	//Check all values of text fields
	function checkDirtyAll() {
		var host = $.trim($("#host").val())
		var userName = $.trim($("#uName").val())
		var password = $.trim($("#passwd").val())
		var wdHome = $.trim($("#wdHome").val())
		var nport = $.trim($("#nport").val())
		var mongoHost = $.trim($("#mongoHost").val())
		var mongoPort = $.trim($("#mongoPort").val())
		var mongoUser = $.trim($("#mongoUser").val())
		var mongoPass = $.trim($("#mongoPass").val())
		var pEmail = $.trim($("#pEmail").val())

		var dbName = $.trim($("#dbName").val())

		if (host != "" || userName != "" || password != "" || wdHome != "" || nport != "" || mongoHost != "" || mongoPort != "" || mongoUser != "" || dbName != "" || pEmail != "") {
			return true
		} else {
			return false
		}
	}
	//Check some values of text fields

	function checkDirtyManual() {
		var nport = $.trim($("#nport").val())
		var mongoHost = $.trim($("#mongoHost").val())
		var mongoPort = $.trim($("#mongoPort").val())
		var dbName = $.trim($("#dbName").val())
		if (nport != "" || mongoHost != "" || mongoPort != "" || dbName != "") {
			return true
		} else {
			return false
		}
	}
	// Reset all field

	function resetAll() {
		$("#host").val("")
		$("#uName").val("")
		$("#passwd").val("")
		$("#wdHome").val("")
		setDefault()
		$('input:radio[name=instType][value=default]').prop('checked', true);


	}
	// Reset field when select install type

	function resetManual() {
		$("#nport").val("")
                $("#jobdir").val("")
                $("#instdir").val("")
                $("#jobclsdir").val("")
                $("#trigdir").val("")
		$("#mongoHost").val("")
		$("#mongoPort").val("")
		$("#dbName").val("")
		$("#mongoUser").val("")
		$("#mongoPass").val("")
		$("#pEmail").val("")

	}

	function disableControl() {
		$("#wdServInstall input").each(function() {
			$(this).prop('disabled', true)
		})
	}

	function enableControl() {
		$("#wdServInstall input").each(function() {
			$(this).prop('disabled', false)
		})
	}

	function setDefault() {
		$("#nport").val(13111).prop('readonly', true)
		$("#rport").val(8089).prop('readonly', true)
		$("#jobdir").val("$INSTALLATION_DIR/var/job").prop('readonly', true)
		$("#instdir").val("$INSTALLATION_DIR/var/job").prop('readonly', true)
		$("#jobclsdir").val("$INSTALLATION_DIR/var/job").prop('readonly', true)
		$("#trigdir").val("$INSTALLATION_DIR/var/job").prop('readonly', true)
		$("#mongoHost").val("127.0.0.1").prop('readonly', true)
		$("#mongoPort").val(27017).prop('readonly', true)
		$("#dbName").val("wiperdog").prop('readonly', true)
		$("#mongoUser").val("").prop('readonly', true)
		$("#mongoPass").val("").prop('readonly', true)
		$("#pEmail").val("test@gmail.com").prop('readonly', true)


	}
	setDefault()
	// Select Operating System
        var beforeOS = $("input:radio[name=os]:checked").val()
	$("input:radio[name=os]").click(function() {
		var value = $(this).val()
		var host = $("input[name=hostSelect]:checked").val()
		if (value == 'win' &amp;&amp; host == 'other' &amp;&amp; beforeOS != value ) {
            $("#warning_pstools").show(400)
            $("#warning_sshkey").hide(400)
            $("#warning_sysser").hide(400)
			$("label[for='uName']").show(400)
			$("#uName").show(400)
			$("label[for='passwd']").show(400)
			$("#passwd").show(400)
		} else if (value == 'linux' &amp;&amp; host == 'other' &amp;&amp; beforeOS != value) {
            $("#warning_pstools").hide(400)
            $("#warning_sshkey").show(400)
            if($("#sysServ").is(":checked")) {
              $("#warning_sysser").show(400)
            }

			$("label[for='uName']").show()
			$("#uName").show(400)
			$("label[for='passwd']").hide(400)
			$("#passwd").hide(400)
		} else {
                        if(beforeOS != value){
			  $("label[for='uName']").hide(400)
			  $("#uName").hide(400)
			  $("label[for='passwd']").hide(400)
			  $("#passwd").hide(400)
                        }

		}
            beforeOS = value
	});
	$("input:radio[name=verSelect]").click(function() {

		var value = $(this).val()
		console.log(value)
		if (value == 'other') {
			$("#version").show(400)
		} else {
			$("#version").hide(400)
			$("#version").val("")
		}
	});
	// Host select
        var beforeHost = $("input:radio[name=hostSelect]:checked").val()
	$("input:radio[name=hostSelect]").click(function() {
		var value = $(this).val()

		if (beforeHost != value &amp;&amp; value == 'other') {
			$("label[for='host']").show(400)
			$("#host").show(400);
			var os = $("input:radio:checked[name=os]").val()
			$("#host").show(400)
			if (os == 'win') {
                $("#warning_pstools").show(400)
                $("#warning_sshkey").hide(400)
				$("label[for='uName']").show(400)
				$("#uName").show(400)
				$("label[for='passwd']").show(400)
				$("#passwd").show(400)
			} else {
                $("#warning_pstools").hide(400)
                $("#warning_sshkey").show(400)
				$("label[for='uName']").show(400)
				$("#uName").show(400)
			}
		} else {
                       
                      if(value == 'local') {
                         $("#warning_pstools").hide(400)
                         $("#warning_sshkey").hide(400)
                      }
                      if(beforeHost != value){
			$("label[for='host']").hide(400)
			$("#host").hide(400);
			$("label[for='uName']").hide(400)
			$("#uName").hide(400)
			$("label[for='passwd']").hide(400)
			$("#passwd").hide(400)
                     }                   
		}
              beforeHost = value

	});
	// Select Install type
	$("input:radio[name=instType]").click(function() {
		var value = $(this).val()
		if (value == 'default') {
			setDefault()

		} else {
			$("#nport").prop('readonly', false)
			$("#rport").prop('readonly', false)
			$("#jobdir").prop('readonly', false)
			$("#instdir").prop('readonly', false)
			$("#jobclsdir").prop('readonly', false)
			$("#trigdir").prop('readonly', false)
			$("#mongoHost").prop('readonly', false)
			$("#mongoPort").prop('readonly', false)
			$("#dbName").prop('readonly', false)
			$("#mongoUser").prop('readonly', false)
			$("#mongoPass").prop('readonly', false)
			$("#pEmail").prop('readonly', false)
			$("#nport").focus()

		}

	});
        //Enhance for check box system service
        $("#sysServ").click( function(){
           if( $(this).is(':checked') ) {
               if($("input[name=os]:checked").val() == 'linux') {
                 $("#warning_sysser").show(400)
               }
           } else {
               $("#warning_sysser").hide(400)
           }
        });
        //Select install wiperdog as system service
	function getErrMess(name) {
		return name + " can not be empty !"
	}
	$("#install").click(function() {
		var regexIP = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/
		var regexEmail = /^(([^&lt;&gt;()[\]\\.,;:\s@\"]+(\.[^&lt;&gt;()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                //Get setting information from input f
		var host = $.trim($("#host").val())
		var userName = $.trim($("#uName").val())
		var password = $.trim($("#passwd").val())
		var wdHome = $.trim($("#wdHome").val())
		var nport = $.trim($("#nport").val())
		var rport = $.trim($("#rport").val())
		var jobdir = $.trim($("#jobdir").val())
		var instdir = $.trim($("#instdir").val())
		var jobclsdir = $.trim($("#jobclsdir").val())
		var trigdir = $.trim($("#trigdir").val())
		var mongoHost = $.trim($("#mongoHost").val())
		var mongoPort = $.trim($("#mongoPort").val())
		var mongoUser = $.trim($("#mongoUser").val())
		var mongoPass = $.trim($("#mongoPass").val())
		var dbName = $.trim($("#dbName").val())
		var pEmail = $.trim($("#pEmail").val())


                // Valid setting 
		var os = $("input[name=os]:checked").val()
		$("#log").val("")
		var hostType = $("input:radio[name=hostSelect]:checked").val()
		if (hostType == 'local') {
			host = 'local'
		}
		//Valid if os selected
		if (hostType == "other" &amp;&amp; host == "") {
			$("#message").text(getErrMess("Host")).addClass("error").removeClass("message")
			return
		} else {
			if (hostType == "other" &amp;&amp; !regexIP.test(host)) {
				$("#message").text("Host IP is not valid !").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}

		}
		if (wdHome == "") {
			$("#message").text(getErrMess("Installation directory ")).addClass("error").removeClass("message")
			return
		} else {
			wdHome = wdHome.replace(/\\/g, '/')
			$("#message").text("").addClass("message").removeClass("error")
		}
		if (hostType == "other") {
			if (os == "win") {
				if (password == "") {
					$("#message").text(getErrMess("Password ")).addClass("error").removeClass("message")
					return
				} else {
					password = password.replace(/\\/g, '/')
					$("#message").text("").addClass("message").removeClass("error")
				}
			}
			if (userName == "") {
				$("#message").text(getErrMess("Username")).addClass("error").removeClass("message")
				return
			} else {
				userName = userName.replace(/\\/g, '/')
				$("#message").text("").addClass("message").removeClass("error")
			}
		}

		//Get version of wiperdog installer
		var version = null
		if ($("input[name=verSelect]:checked").val() == 'other') {
			version = $("#version").val()
		} else {
			version = 'LATEST'
		}
		//Valid if install type selected
		var instType = $("input[name=instType]:checked").val()
		if (nport == "") {
			$("#message").text(getErrMess("Netty port ")).addClass("error").removeClass("message")
			return
		} else {
			if (!($.isNumeric(nport))) {
				$("#message").text("Netty port must be numeric").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}
		}

		if (rport == "") {
			$("#message").text(getErrMess("RESTful port ")).addClass("error").removeClass("message")
			return
		} else {
			if (!($.isNumeric(nport))) {
				$("#message").text("RESTful port must be numeric").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}
		}
		if (jobdir == "") {
			$("#message").text(getErrMess("Job directory")).addClass("error").removeClass("message")
			return
		} else {
                       if(jobdir.match("^\\$INSTALLATION_DIR")) {                           
                           jobdir = jobdir.replace("$INSTALLATION_DIR",wdHome)
                        }
			$("#message").text("").addClass("message").removeClass("error")
		}

		if (instdir == "") {
			$("#message").text(getErrMess("Instance directory")).addClass("error").removeClass("message")
			return
		} else {
                        if(instdir.match("^\\$INSTALLATION_DIR")) {                           
                           instdir = instdir.replace("$INSTALLATION_DIR",wdHome)
                        }

			$("#message").text("").addClass("message").removeClass("error")
		}

		if (jobclsdir == "") {
			$("#message").text(getErrMess("Job class directory")).addClass("error").removeClass("message")
			return
		} else {
                        if(jobclsdir.match("^\\$INSTALLATION_DIR")) {                           
                           jobclsdir = jobclsdir.replace("$INSTALLATION_DIR",wdHome)
                        }
			$("#message").text("").addClass("message").removeClass("error")

		}

		if (trigdir == "") {
			$("#message").text(getErrMess("Tr directory")).addClass("error").removeClass("message")
			return 
		} else {
                        if(trigdir.match("^\\$INSTALLATION_DIR")) {                           
                           trigdir = trigdir.replace("$INSTALLATION_DIR",wdHome)
                        }

			$("#message").text("").addClass("message").removeClass("error")
		}

		if (mongoHost == "") {
			$("#message").text(getErrMess("Mongo host ")).addClass("error").removeClass("message")
			return
		} else {
			if (mongoHost != "localhost" &amp;&amp; !regexIP.test(mongoHost)) {
				$("#message").text("Mongo host is invalid,it must be an IP address or 'localhost' !").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}
		}
		if (mongoPort == "") {
			$("#message").text(getErrMess("Mongo port ")).addClass("error").removeClass("message")
			return
		} else {
			if (!($.isNumeric(mongoPort))) {
				$("#message").text("Mongo port must be numeric").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}
		}

		if (dbName == "") {
			$("#message").text(getErrMess("Database name ")).addClass("error").removeClass("message")
			return
		} else {
			$("#message").text("").addClass("message").removeClass("error")
		}

		if (pEmail == "") {
			$("#message").text(getErrMess("Email to sent policy message to ")).addClass("error").removeClass("message")
			return
		} else {
			if (!regexEmail.test(pEmail)) {
				$("#message").text("Incorrect email address !.").addClass("error").removeClass("message")
				return
			} else {
				$("#message").text("").addClass("message").removeClass("error")
			}
		}

		var sysServ = null
		if ($('#sysServ').is(":checked")) {
			sysServ = "yes"
		} else {
			sysServ = "no"
		}
                

		//Provide information about remote host to download wiperdog installer
		var mapData2Download = {
			host: host,
			os: os,
			userName: userName,
			password: password,
			wdHome: wdHome,
			version: version
		}
		var mapData2Install = {
			host: host,
			os: os,
			userName: userName,
			password: password,
			wdHome: wdHome,
			nettyPort: nport,
			restPort: rport,
            jobdir: jobdir,
            instdir: instdir,
            jobclsdir: jobclsdir,
            trigdir: trigdir,
			mongoHost: mongoHost,
			mongoPort: mongoPort,
			dbName: dbName,
			mongoUser: mongoUser,
			mongoPass: mongoPass,
			pEmail: pEmail,
			sysServ: sysServ,
			version: version
		}
		var dataInstall = {
			action: 'doInstall',
			data: JSON.stringify(mapData2Install)
		}
		console.log(dataInstall)
		var dataDownload = {
			action: 'doDownload',
			data: JSON.stringify(mapData2Download)
		}
		console.log(dataDownload)
		disableControl()
		// if data valid ,send data by an ajax to other page to process install
		$("#message").text("Downloading...this may takes a few minutes.").addClass('message').removeClass('error')
		//Download file and Install file
		$.ajax({
			type: "POST",
			url: "/xwiki/bin/get/WiperDog/ProcInstallWDService?outputSyntax=plain",
			dataType: "text",
			data: dataDownload,
			crossDomain: true,
			success: function(dlresult) {
				console.log(dlresult)
				var dlResultObj = $.parseJSON(dlresult)
				var txtAreaVal = $("#log").val()
				txtAreaVal += "--------------------------------------------------------------------------- \n"
				txtAreaVal += "--------------------DOWNLOAD PACKAGE WIPERDOG TO INSTALL------------------- \n"
				txtAreaVal += dlResultObj.message
				txtAreaVal += "\n"

				if (dlResultObj.status == "success") {
					$("#logDiv").show()
					$("#log").val(txtAreaVal)
					$("#message").text("Download complete ,check log for more information.").addClass('message').removeClass('error')
					setTimeout(function() {
						$("#message").text("Installing...").addClass('message').removeClass('error')
					}, 1500);

					$.ajax({
						type: "POST",
						url: "/xwiki/bin/get/WiperDog/ProcInstallWDService?outputSyntax=plain",
						dataType: "text",
						data: dataInstall,
						crossDomain: true,
						success: function(insresult) {

							var objResult = $.parseJSON(insresult)
							console.log(objResult)
							if (objResult != null &amp;&amp; objResult != []) {
								txtAreaVal = $("#log").val()
								txtAreaVal += "------------------------------------------------------- \n"
								txtAreaVal += "----------------------INSTALLATION--------------------- \n"
								txtAreaVal += objResult.message
								$("#log").val(txtAreaVal)
							}
							$("#message").text("Install complete ,check log for more information .").addClass('message').removeClass('error')
							enableControl()


						},
						error: function(xhr, status, error) {
							console.log(xhr)
							console.log(status)
							console.log(error)
						}
					});
				} else {
					$("#message").text("Download wiperdog installer failed ,check log for more information.").addClass('error').removeClass('message')
					$("#logDiv").show()
					$("#log").val(txtAreaVal)
					enableControl()

				}
			},
			error: function(xhr, status, error) {
				console.log(xhr)
				console.log(status)
				console.log(error)
                                $("#message").text("Failed to install wiperdog !").addClass('error').removeClass('message')
			}
		});
	})

	jQuery.noConflict()
 })</code>

    </property>
    <property>
      <name>JSprocess</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>66489225-eb05-472d-b897-2391155f5786</guid>
    <property>
      <cache>long</cache>
    </property>
    <property>
<code>label{
display: block;
font-weight: bold

}
#wdHome{
 width: 300px
}
.message{
 margin-left:300px;
 font-weight:bold;
 color:green;
display: block
}

#wdServInstall{
 margin-left: 300px
}
#winProc{
  display: none
}

.message {
 font-weight: bold;
 color: green
}
.error{
 font-weight: bold;
 color: red
}
#logDiv{
 display: none
}
#log{
 width: 500px;
 min-heigth: 500px;
 over-flow: scroll;

}
#install {
 margin-left: 50px
}
#message{
 margin-left: 10px
}
#xwikicontent input{
 background-color: #FAFFBD
}
#version{
 display: none
}
h4 {
 color : #2173AF
}
.warning {
 width : 400px;
 display: none;
}
</code>

    </property>
    <property>
      <name>stylesheet</name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>0</number>
    <className>XWiki.XWikiRights</className>
    <guid>c65bca33-22ef-4d94-98e3-9e4fec4ec40b</guid>
    <property>
      <allow>1</allow>
    </property>
    <property>
      <groups>xwiki:XWiki.XWikiAdminGroup,</groups>
    </property>
    <property>
      <levels>view,edit,delete,comment</levels>
    </property>
    <property>
      <users/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>2</number>
    <className>XWiki.XWikiRights</className>
    <guid>8f82481f-76a5-45bf-be8c-104da9cc3d8b</guid>
    <property>
      <allow>0</allow>
    </property>
    <property>
      <groups>xwiki:XWiki.XWikiAllGroup,</groups>
    </property>
    <property>
      <levels>edit,delete</levels>
    </property>
    <property>
      <users/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>3</number>
    <className>XWiki.XWikiRights</className>
    <guid>51449304-1624-4941-a37c-44b0aa13f860</guid>
    <property>
      <allow>1</allow>
    </property>
    <property>
      <groups>xwiki:XWiki.XWikiAllGroup,</groups>
    </property>
    <property>
      <levels>view,comment</levels>
    </property>
    <property>
      <users/>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>4</number>
    <className>XWiki.XWikiRights</className>
    <guid>08e13af2-ae24-4c44-9625-746bc71cb426</guid>
    <property>
      <allow>1</allow>
    </property>
    <property>
      <groups/>
    </property>
    <property>
      <levels>view,comment</levels>
    </property>
    <property>
      <users>XWiki.XWikiGuest</users>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.XWikiRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <name>WiperDog.WiperdogServiceInstallation</name>
    <number>5</number>
    <className>XWiki.XWikiRights</className>
    <guid>0492a6b2-4c48-47c4-b3f7-5e0f60255fe0</guid>
    <property>
      <allow>0</allow>
    </property>
    <property>
      <groups/>
    </property>
    <property>
      <levels>edit,delete</levels>
    </property>
    <property>
      <users>XWiki.XWikiGuest</users>
    </property>
  </object>
  <content>{{velocity}}
$xwiki.ssx.use("WiperDog.checkService")
{{/velocity}}

{{include document="WiperDog.checkService"/}}

{{html wiki = 'false' clean = 'false'}}
&amp;nbsp;
&lt;div id='wdServInstall' &gt;
   &lt;form action='#wdServInstall' method='POST' &gt;
      &lt;h4 class="header" &gt;Operating System&lt;/h4&gt;
      &lt;input type='radio' name='os' value='linux' checked = 'true'/&gt;Linux
      &lt;input type='radio' name='os' value='win'/&gt;Windows
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;label&gt;Host&lt;/label&gt;
      &lt;input type='radio' name='hostSelect' value='local' checked = 'true' /&gt;Local host
      &lt;input type='radio' name='hostSelect' value='other' /&gt;Other host
      &lt;br/&gt;
      &lt;p class="warning" id='warning_sshkey'&gt;
        **** To installing wiperdog on Linux remote host , you need to using ssh keys to accessing to remote host without password require.
       Please refere to &lt;a href="http://sshmenu.sourceforge.net/articles/key-setup.html"&gt;this link&lt;/a&gt;
      &lt;/p&gt;
      &lt;p class="warning" id='warning_pstools'&gt;
        **** To installing wiperdog on Windows remote host , you need to using PSTools as a system environment program to accessing remote host.
       &lt;br/&gt; Step to do: 
       &lt;br/&gt; 1. Download &lt;a href="http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx"&gt;PSTools&lt;/a&gt; 
       &lt;br/&gt; 2. Extract to somewhere on machine which Xwiki installed
       &lt;br/&gt; 4. Set an environment variable named is "PSTOOLS" to extracted folder 
       &lt;br/&gt; 5. Restart Xwiki and comeback to this page for your installation
      
      &lt;/p&gt;
      &lt;label for='host' style="display:none" &gt;Host IP&lt;/label&gt;
      &lt;input type='text' value='' id='host' name='host' style="display:none" /&gt;
      &lt;label for='uName' style="display:none" &gt;Username&lt;/label&gt;
      &lt;input type='text'  id='uName' name='usName' autocomplete = 'false' style="display:none"/&gt;
      &lt;br/&gt;
      &lt;label for='passwd' style = "display: none"&gt;Password&lt;/label&gt;
      &lt;input type='password'  id='passwd' name='pswd' autocomplete = 'false' style = "display: none"/&gt;
      &lt;br/&gt;
      &lt;label for='host'&gt;Version&lt;/label&gt;
      &lt;input type='radio' name='verSelect' value='lastest' checked = 'true'/&gt;Lastest version
      &lt;input type='radio' name='verSelect' value='other' /&gt;Other version
      &lt;br/&gt;
      &lt;a href=http://mvnrepository.com/artifact/org.wiperdog target="_blank"&gt;Check available version&lt;/a&gt;
      &lt;br/&gt;
      &lt;input type='text' value='' id='version' name='version' /&gt;
      &lt;h4 for='wdHome' class="header"&gt;Installation wiperdog directory: &lt;/h4&gt;
      &lt;input type='text' value='' id='wdHome' name='wdHome' /&gt;
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;h4 class="header"&gt;Select install type: &lt;/h4&gt;
      &lt;input type='radio' name='instType' value='default' checked = 'true' /&gt;Default install 
      &lt;input type='radio' name='instType' value='manual' /&gt;Manual install
      &lt;h4 class="header"&gt;Setting Information  &lt;/h4&gt;
      &lt;div id = "manual"&gt;
         &lt;label for='nport'&gt;Netty port : &lt;/label&gt;
         &lt;input type='text' value='' id='nport' name='nport' /&gt;
         &lt;label for='nport'&gt;RESTful port : &lt;/label&gt;
         &lt;input type='text' value='' id='rport' name='rport' /&gt;
         &lt;label for='jobdir'&gt;Job directory : &lt;/label&gt;
         &lt;input type='text' value='' id='jobdir' name='jobdir' /&gt;
         &lt;label for='instdir'&gt;Instances directory : &lt;/label&gt;
         &lt;input type='text' value='' id='instdir' name='instdir' /&gt;
         &lt;label for='jobclsdir'&gt;Job class directory : &lt;/label&gt;
         &lt;input type='text' value='' id='jobclsdir' name='jobclsdir' /&gt;
         &lt;label for='trigdir'&gt;Trigger directory : &lt;/label&gt;
         &lt;input type='text' value='' id='trigdir' name='trigdir' /&gt;
         &lt;label for='mongoHost'&gt;MongoDB host :&lt;/label&gt;
         &lt;input type='text' value='' id='mongoHost' name='mongoHost' /&gt;
         &lt;label for='mongoPort'&gt;MongoDB port :&lt;/label&gt;
         &lt;input type='text' value='' id='mongoPort' name='mongoPort' /&gt;
         &lt;label for='mongoUser'&gt;MongoDB user :&lt;/label&gt;
         &lt;input type='text' value='' id='mongoUser' name='mongoUser' /&gt;
         &lt;label for='mongoPass'&gt;MongoDB password :&lt;/label&gt;
         &lt;input type='password' value='' id='mongoPass' name='mongoPass' /&gt;
         &lt;label for='dbName'&gt;Mongo Database name : &lt;/label&gt;
         &lt;input type='text' value='' id='dbName' name='dbName' /&gt;
         &lt;label for='pEmail'&gt;Email to sent policy message to : &lt;/label&gt;
         &lt;input type='text' value='' id='pEmail' name='pEmail' /&gt;
      &lt;/div&gt;
      &lt;br/&gt;
      &lt;label for='sysServ'&gt;&lt;input type='checkbox'  id='sysServ' name='sysServ' /&gt;Install wiperdog as system service&lt;/label&gt;
      &lt;p class="warning" id="warning_sysser" &gt;
        *** To install wiperdog as service ,user must be root or using "sudo" command without password prompt
        To do that ,please refere to &lt;a href="http://jeromejaglale.com/doc/unix/ubuntu_sudo_without_password"&gt;this link &lt;/a&gt;
      &lt;p&gt;
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;input type="button" value = 'Install' id="install" class = 'button'/&gt;
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;div id="message"&gt;&lt;/div&gt;
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;div id='logDiv'&gt;&lt;label for='log' &gt;Log:&lt;/label&gt;&lt;textarea id='log'&gt;&lt;/textarea&gt;&lt;/div&gt;
   &lt;/form&gt;
&lt;/div&gt;
&amp;nbsp;
{{/html}}</content></xwikidoc>